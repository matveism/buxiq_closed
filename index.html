<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bux iQ - Premium Rewards Platform</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    
    <!-- Google OAuth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
    :root {
        /* Deep Blue Gradient Colors */
        --primary-dark: #0a0f2d;
        --primary-main: #0f1a41;
        --primary-light: #1a2a5e;
        --primary-lighter: #253776;
        
        /* Accent Colors */
        --accent-primary: #3a86ff;
        --accent-secondary: #5aa9e6;
        --accent-success: #4cc9f0;
        
        /* Backgrounds */
        --bg-default: #050816;
        --bg-paper: #0a1029;
        --bg-elevated: #101935;
        
        /* Text Colors */
        --text-primary: #ffffff;
        --text-secondary: #b3c5ef;
        --text-muted: #8a9cc9;
        
        /* UI Elements */
        --border-color: #1e2b52;
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        background: linear-gradient(135deg, var(--bg-default) 0%, var(--primary-dark) 100%);
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
        overflow-x: hidden;
        line-height: 1.6;
        min-height: 100vh;
    }
    
    #root {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }
    
    /* Header */
    .app-header {
        background: var(--bg-paper);
        border-bottom: 1px solid var(--border-color);
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow);
    }
    
    .logo-container {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .logo {
        height: 70px;
        width: auto;
    }
    
    .app-title {
        font-size: 1.5rem;
        font-weight: 700;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .header-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .time-display {
        font-weight: 500;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    /* Main Content */
    .app-content {
        flex: 1;
        padding: 1.5rem;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
    }
    
    /* Dashboard Grid */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    @media (max-width: 1024px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }
    
    /* Cards */
    .card {
        background: var(--bg-paper);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        border: 1px solid var(--border-color);
        transition: var(--transition);
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    .card-header {
        margin-bottom: 1.25rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .card-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    /* Activity Log */
    .activity-log {
        background: var(--bg-elevated);
        border-radius: 8px;
        height: 180px;
        overflow-y: auto;
        padding: 1rem;
        font-size: 0.875rem;
        margin-bottom: 1.5rem;
    }
    
    .activity-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .activity-item:last-child {
        border-bottom: none;
    }
    
    .activity-icon {
        margin-right: 0.75rem;
        color: var(--accent-primary);
        width: 20px;
        text-align: center;
    }
    
    /* User Profile */
    .user-profile {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .user-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        border: 3px solid var(--accent-primary);
        object-fit: cover;
    }
    
    .user-details {
        flex: 1;
    }
    
    .user-name {
        font-weight: 600;
        font-size: 1.25rem;
        margin-bottom: 0.25rem;
    }
    
    .user-level {
        color: var(--text-muted);
        font-size: 0.9rem;
    }
    
    .user-stats {
        display: flex;
        gap: 1.5rem;
    }
    
    .stat {
        text-align: center;
    }
    
    .stat-value {
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--accent-primary);
    }
    
    .stat-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* Buttons */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        transition: var(--transition);
        border: none;
        font-size: 0.9rem;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        box-shadow: 0 4px 12px rgba(58, 134, 255, 0.3);
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(58, 134, 255, 0.4);
    }
    
    .btn-secondary {
        background: var(--bg-elevated);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }
    
    .btn-secondary:hover {
        background: var(--primary-light);
    }
    
    .btn-full {
        width: 100%;
    }
    
    /* Tabs */
    .tabs-container {
        display: flex;
        overflow-x: auto;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        scrollbar-width: none;
    }
    
    .tabs-container::-webkit-scrollbar {
        display: none;
    }
    
    .tab {
        padding: 0.75rem 1.25rem;
        margin-right: 0.5rem;
        border-radius: 8px;
        background: var(--bg-elevated);
        cursor: pointer;
        font-weight: 500;
        white-space: nowrap;
        transition: var(--transition);
        border: 1px solid transparent;
        color: var(--text-secondary);
    }
    
    .tab.active {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        box-shadow: 0 4px 12px rgba(58, 134, 255, 0.3);
    }
    
    .tab:hover:not(.active) {
        border-color: var(--accent-primary);
        color: var(--text-primary);
    }
    
    /* Section Management */
    .section {
        display: block;
        animation: fadeIn 0.5s ease;
    }
    
    .section.hidden {
        display: none;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Offer Grid */
    .offer-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .offer-item {
        background: var(--bg-elevated);
        border-radius: 10px;
        padding: 1.25rem;
        text-align: center;
        transition: var(--transition);
        border: 1px solid var(--border-color);
    }
    
    .offer-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        border-color: var(--accent-primary);
    }
    
    .offer-image {
        max-width: 100%;
        height: 60px;
        object-fit: contain;
        margin-bottom: 0.75rem;
    }
    
    /* Leaderboard */
    .leaderboard {
        background: var(--bg-elevated);
        border-radius: 10px;
        overflow: hidden;
    }
    
    .leaderboard table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .leaderboard th {
        background: var(--primary-light);
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: var(--text-secondary);
    }
    
    .leaderboard td {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
    }
    
    .leaderboard tr:last-child td {
        border-bottom: none;
    }
    
    .leaderboard tr:hover td {
        background: rgba(255, 255, 255, 0.05);
    }
    
    /* Forms */
    .form-group {
        margin-bottom: 1.25rem;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-secondary);
    }
    
    .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: var(--bg-elevated);
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
        transition: var(--transition);
    }
    
    .form-input:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 2px rgba(58, 134, 255, 0.2);
    }
    
    .captcha-display {
        font-family: 'Courier New', monospace;
        font-size: 1.5rem;
        font-weight: bold;
        letter-spacing: 6px;
        padding: 0.75rem 1rem;
        background: rgba(58, 134, 255, 0.1);
        border: 1px solid rgba(58, 134, 255, 0.3);
        border-radius: 8px;
        margin-bottom: 1rem;
        text-align: center;
        user-select: none;
    }
    
    /* Divider */
    .divider {
        display: flex;
        align-items: center;
        text-align: center;
        margin: 1.5rem 0;
        color: var(--text-muted);
    }
    
    .divider::before,
    .divider::after {
        content: '';
        flex: 1;
        border-bottom: 1px solid var(--border-color);
    }
    
    .divider span {
        padding: 0 1rem;
    }
    
    /* Alert Box */
    .alert {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: flex-start;
    }
    
    .alert-warning {
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.3);
        color: #ffc107;
    }
    
    .alert-icon {
        margin-right: 0.75rem;
        margin-top: 2px;
    }
    
    /* FAQ Items */
    .faq-item {
        background: var(--bg-elevated);
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: var(--transition);
        border: 1px solid var(--border-color);
    }
    
    .faq-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    
    .faq-question {
        margin-bottom: 0.75rem;
        color: var(--accent-primary);
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    /* Iframe Container */
    .iframe-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(5, 8, 22, 0.95);
        z-index: 9999;
        display: none;
    }
    
    .iframe-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        background: var(--bg-paper);
        color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }
    
    .iframe-content {
        height: calc(100% - 60px);
        padding: 0 1.5rem 1.5rem;
    }
    
    #dashboardIframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 8px;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 6px;
    }
    
    ::-webkit-scrollbar-track {
        background: var(--primary-dark);
        border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: var(--primary-light);
        border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--accent-primary);
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .app-header {
            padding: 1rem;
        }
        
        .app-content {
            padding: 1rem;
        }
        
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
        
        .user-profile {
            flex-direction: column;
            text-align: center;
        }
        
        .user-stats {
            justify-content: center;
        }
        
        .offer-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 480px) {
        .app-title {
            font-size: 1.25rem;
        }
        
        .tab {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .offer-grid {
            grid-template-columns: 1fr;
        }
    }
    
    /* Utility classes */
    .hidden {
        display: none !important;
    }
    
    .text-center {
        text-align: center;
    }
    
    .mb-1 {
        margin-bottom: 0.5rem;
    }
    
    .mb-2 {
        margin-bottom: 1rem;
    }
    
    .mb-3 {
        margin-bottom: 1.5rem;
    }
    
    .mt-1 {
        margin-top: 0.5rem;
    }
    
    .mt-2 {
        margin-top: 1rem;
    }
    
    .mt-3 {
        margin-top: 1.5rem;
    }
</style>
</head>
<body>
    <div id="root">
        <!-- App Header -->
        <header class="app-header">
            <div class="logo-container">
                <img src="https://i.postimg.cc/TwGMVJpd/Screenshot-2025-10-13-at-10-02-07-AM-removebg-preview.png" alt="BUXiQ Logo" class="logo">
                
            </div>
            <div class="header-actions">
                <div class="time-display" id="headerTime">12:00 PM</div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="app-content">
            <!-- Alert Banner -->
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle alert-icon"></i>
                <div>NEW! $1 = (1) pts & 50% user gets only!</div>
            </div>
            
            <!-- Tabs Navigation -->
            <div class="tabs-container">
                <div class="tab active" data-section="dashboard">Dashboard</div>
                <div class="tab" data-section="earn">Earn</div>
                <div class="tab" data-section="shop">Shop</div>
                <div class="tab" data-section="leaders">Leaders</div>
                <div class="tab" data-section="bonus">Bonus</div>
                <div class="tab" data-section="tos">Terms</div>
                <div class="tab" data-section="help">Help</div>
            </div>
            
            <!-- Dashboard Section -->
            <div id="section-dashboard" class="section">
                <div class="dashboard-grid">
                    <div>
                        <!-- Activity Log -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Activity Log</h2>
                                <div class="card-actions">
                                    <button class="btn btn-secondary" id="refreshLogs">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="activity-log" id="logs">
                                <div class="activity-item">
                                    <div class="activity-icon"><i class="fas fa-info-circle"></i></div>
                                    <div>Your activity log will appear here</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- User Profile -->
                        <div class="card">
                            <div class="user-profile">
                                <img src="https://ui-avatars.com/api/?background=3a86ff&color=fff&name=Guest&bold=true" class="user-avatar" id="userAvatar" alt="User Avatar">
                                <div class="user-details">
                                    <div class="user-name" id="userName">Guest User</div>
                                    <div class="user-level">Level <span id="userLevel">0</span></div>
                                    <div class="user-stats">
                                        <div class="stat">
                                            <div class="stat-value" id="userBalance">$0.00</div>
                                            <div class="stat-label">Balance</div>
                                        </div>
                                        <div class="stat">
                                            <div class="stat-value" id="userPoints">0</div>
                                            <div class="stat-label">Points</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary btn-full" id="loginButton">Login to Earn Rewards</button>
                        </div>
                        
                        <!-- How It Works -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">How It Works</h2>
                            </div>
                            <div class="offer-grid">
                                <div class="offer-item">
                                    <i class="fas fa-tasks" style="font-size: 2rem; color: var(--accent-primary); margin-bottom: 0.5rem;"></i>
                                    <h3>Complete Surveys</h3>
                                </div>
                                <div class="offer-item">
                                    <i class="fas fa-star" style="font-size: 2rem; color: var(--accent-primary); margin-bottom: 0.5rem;"></i>
                                    <h3>Earn Stars</h3>
                                </div>
                                <div class="offer-item">
                                    <i class="fas fa-gift" style="font-size: 2rem; color: var(--accent-primary); margin-bottom: 0.5rem;"></i>
                                    <h3>Redeem Rewards</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <!-- Cashout Options -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Cashout Options</h2>
                            </div>
                            <div class="offer-grid">
                                <div class="offer-item">
                                    <i class="fab fa-amazon" style="font-size: 2rem; color: var(--accent-primary); margin-bottom: 0.5rem;"></i>
                                    <h3>Amazon UK</h3>
                                </div>
                                <div class="offer-item">
                                    <i class="fab fa-bitcoin" style="font-size: 2rem; color: var(--accent-primary); margin-bottom: 0.5rem;"></i>
                                    <h3>LTC Crypto</h3>
                                </div>
                                <div class="offer-item">
                                    <i class="fas fa-plus" style="font-size: 2rem; color: var(--accent-primary); margin-bottom: 0.5rem;"></i>
                                    <h3>More Soon!</h3>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Server Status -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Server Status</h2>
                            </div>
                            <div class="text-center mb-2">
                                <div class="stat-value">Online</div>
                                <div class="stat-label">All Systems Operational</div>
                            </div>
                            <div id="serverTime" class="text-center">Server Time: 00:00:00</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Earn Section -->
            <div id="section-earn" class="section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Earning Portal</h2>
                    </div>
                    <div id="login-container">
                        <h3 class="text-center mb-2">Login to Access Offer Walls</h3>
                        
                        <!-- Google Login Button -->
                        <div id="g_id_onload"
                            data-client_id="387422659555-007kjhq0c41f2lq39e075ib5mtpf3q9o.apps.googleusercontent.com"
                            data-context="signin"
                            data-ux_mode="popup"
                            data-callback="handleGoogleCredentialResponse"
                            data-auto_prompt="false">
                        </div>

                        <div class="g_id_signin mb-2" 
                             data-type="standard" 
                             data-theme="filled_blue" 
                             data-text="signin_with" 
                             data-shape="rectangular" 
                             data-logo_alignment="left">
                        </div>
                        
                        <div class="divider">
                            <span>OR</span>
                        </div>
                        
                        <!-- Manual Login -->
                        <form class="mt-2">
                            <div class="form-group">
                                <label for="login-account" class="form-label">Account #</label>
                                <input type="text" id="login-account" class="form-input" placeholder="Enter your account number">
                            </div>
                            
                            <div class="form-group">
                                <label for="login-clientid" class="form-label">Client ID</label>
                                <input type="text" id="login-clientid" class="form-input" placeholder="Enter your client ID">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">CAPTCHA</label>
                                <div class="captcha-display" id="captcha"></div>
                                <input type="text" id="captchaInput" class="form-input" placeholder="Enter CAPTCHA">
                            </div>
                            
                            <button type="button" class="btn btn-primary btn-full" id="loginFormButton">Login</button>
                        </form>
                        <div id="error-msg" class="hidden mt-2" style="color: #ff6b6b; text-align: center; padding: 0.75rem; background: rgba(255, 107, 107, 0.1); border-radius: 8px;"></div>
                    </div>
                    
                    <div id="dashboard" class="hidden">
                        <p class="text-center mb-3">Complete offers and surveys to earn rewards</p>
                        
                        <div class="offer-grid" id="offerwall-grid">
                            <div class="offer-item">
                                <img src="https://i.postimg.cc/LshWhq2y/Gemini-Generated-Image-rueqf9rueqf9rueq-removebg-preview.png" alt="CPX Research Logo" class="offer-image">
                                <button class="btn btn-primary" id="openOfferWallCPX">Open OfferWall</button>
                            </div>

                            <div class="offer-item">
                                <img src="https://i.postimg.cc/6q7RvXyX/Gemini-Generated-Image-p6bmmsp6bmmsp6bm-removebg-preview.png" alt="Excentiv Logo" class="offer-image">
                                <button class="btn btn-primary" id="openOfferWallexcentiv">Open OfferWall</button>
                            </div>

                            <div class="offer-item">
                                <img src="https://i.postimg.cc/76hXmjf9/Gemini-Generated-Image-gwivdggwivdggwiv-removebg-preview.png" alt="ES Logo" class="offer-image">
                                <button class="btn btn-secondary" id="openOfferWalles">WAITING FOR APPROVAL</button>
                            </div>

                            <div class="offer-item">
                                <img src="https://pocketsfull.ai/assets/images/logo.png" alt="PocketsFull Logo" class="offer-image">
                                <button class="btn btn-primary" id="openOfferWallpockets">Open OfferWall</button>
                            </div>

                            <div class="offer-item">
                                <img src="https://siteowner.timewall.io/img/logo/TimeWall_logo_homepage_mobile.png" alt="TimeWall Logo" class="offer-image">
                                <button class="btn btn-primary" id="openOfferWalltw">Open OfferWall</button>
                            </div>

                            <div class="offer-item">
                                <img src="https://revtoo.com/assets/offerwall/images/revtoo-dark.svg" alt="RevToo Logo" class="offer-image">
                                <button class="btn btn-primary" id="openOfferWallrevtoo">Open OfferWall</button>
                            </div>

                            <div class="offer-item">
                                <img src="https://primewall.io/asset/home_1/img/primewalllogo.svg" alt="PrimeWall Logo" class="offer-image">
                                <button class="btn btn-primary" id="openOfferWallprimewall">Open OfferWall</button>
                            </div>
                        </div>
                        
                        <button class="btn btn-secondary btn-full mt-2" id="logoutBtn">Logout</button>
                    </div>
                </div>
            </div>
            
            <!-- Shop Section -->
            <div id="section-shop" class="section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Shop Rewards</h2>
                    </div>
                    <div class="offer-grid">
                        <div class="offer-item">
                            <img src="https://i.postimg.cc/pT1vSNkk/Gemini-Generated-Image-mqybpwmqybpwmqyb-removebg-preview.png" alt="BUXiQ Logo" class="offer-image">
                            <button class="btn btn-primary" id="openOfferWallbuxiq">Cashout</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Leaders Section -->
            <div id="section-leaders" class="section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Leaderboard</h2>
                    </div>
                    <div class="leaderboard">
                        <table>
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Username</th>
                                    <th>Earnings</th>
                                    <th>Level</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardBody">
                                <tr>
                                    <td>1</td>
                                    <td>Loading...</td>
                                    <td>$0.00</td>
                                    <td>0</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Bonus Section -->
            <div id="section-bonus" class="section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Redeem Bonus Code</h2>
                    </div>
                    
                    <div class="alert alert-warning mb-3">
                        <i class="fas fa-exclamation-triangle alert-icon"></i>
                        <div>WHO FIRST REDEEMED HIS/HER PTS! EACH BONUS CODE WILL BE MARKED AS UNUSED - FIRST COME FIRST SERVED!!!</div>
                    </div>
                    
                    <form id="redeemForm">
                        <div class="form-group">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" id="username" class="form-input" required placeholder="Enter your username">
                        </div>
                        
                        <div class="form-group">
                            <label for="bonusCode" class="form-label">Bonus Code</label>
                            <input type="text" id="bonusCode" class="form-input" required placeholder="Enter bonus code">
                        </div>
                        
                        <button type="button" class="btn btn-primary btn-full" id="redeemBonusButton">Redeem Bonus Code</button>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem;">
                            <div class="form-group">
                                <label for="amountLocal" class="form-label">Amount (Local)</label>
                                <input type="text" id="amountLocal" class="form-input" readonly placeholder="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="amountUsd" class="form-label">Amount (USD)</label>
                                <input type="text" id="amountUsd" class="form-input" readonly placeholder="$0.00">
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Terms of Service Section -->
            <div id="section-tos" class="section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Terms of Service</h2>
                    </div>
                    
                    <div class="alert alert-warning mb-3">
                        <i class="fas fa-exclamation-triangle alert-icon"></i>
                        <div><strong>Important:</strong> Please read these terms carefully before using our services.</div>
                    </div>
                    
                    <div class="mb-3">
                        <h3 class="faq-question">Account Policy</h3>
                        <p>Users are strictly prohibited from maintaining multiple accounts. If we detect multiple accounts associated with a single user, we reserve the right to permanently ban all accounts without any prior notice. This action is permanent and cannot be appealed.</p>
                    </div>
                    
                    <div class="mb-3">
                        <h3 class="faq-question">Activity Requirements</h3>
                        <p>To maintain an active account status, users must complete at least 2 tasks within any 7-day period. Failure to meet this activity requirement may result in account suspension or termination.</p>
                        <p><strong>Please note:</strong> Bonus code redemptions do NOT count toward activity requirements. While level completions may appear to count in the system interface, according to our Terms of Service, they are not considered valid activity for maintaining account status.</p>
                    </div>
                    
                    <div class="mb-3">
                        <h3 class="faq-question">Account Access</h3>
                        <p>If you do not have a Google account, you have two options:</p>
                        <ol>
                            <li>Create a new Google account</li>
                            <li>Contact our support team to receive login credentials</li>
                        </ol>
                    </div>
                    
                    <div class="mb-3">
                        <h3 class="faq-question">General Terms</h3>
                        <p>By using our services, you agree to comply with all applicable laws and regulations. We reserve the right to modify these terms at any time without prior notice. Continued use of our services after changes constitutes acceptance of the modified terms.</p>
                    </div>
                    
                    <div style="display: flex; gap: 1rem;">
                        <button type="button" class="btn btn-primary" id="acceptTosButton">I Accept the Terms of Service</button>
                        <button type="button" class="btn btn-secondary" id="declineTosButton">Decline</button>
                    </div>
                </div>
            </div>
            
            <!-- Help Section -->
            <div id="section-help" class="section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Help & Support</h2>
                    </div>
                    
                    <div class="faq-item">
                        <h3 class="faq-question">How do I earn points?</h3>
                        <p>1. IF YOU DID NOT LOGGED IN YET LOGIN FIRST AND THEN EITHER CLICK LOGIN TO EARN IF YOU ARE IN THE HOME PAGE.</p>
                        <p>2. CLICK EITHER TAB ABOVE, EITHER BELOW, BUTTON or TAB EARN.</p>
                        <p>3. YOU ALL SEE OFFERWALLS AND YOU CLICK ON THEM DO OFFERS OR SURVEYS!</p>
                    </div>
                    
                    <div class="faq-item">
                        <h3 class="faq-question">How can I redeem rewards?</h3>
                        <p>YOU MAY CLICK EITHER ABOVE, OR, BELOW TAB OR BUTTON "SHOP".</p>
                    </div>
                    
                    <div class="faq-item">
                        <h3 class="faq-question">HOW TO REDEEM BONUS CODE?</h3>
                        <p>CLICK TAB OR BUTTON<strong> BONUS</strong> YOU MUST FILL OUT A FORM PUT YOUR ACCOUNT# AND ENTER BONUS CODE.</p>
                    </div>
                    
                    <div class="faq-item">
                        <h3 class="faq-question">Who do I contact for support?</h3>
                        <p>Our ADMIN is available from 10 am - 5 pm PST. Click the button below to contact us.</p>
                    </div>
                    
                    <button class="btn btn-primary btn-full mt-2" id="contact-support-btn">Contact Support</button>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Iframe Container -->
    <div class="iframe-container" id="iframeContainer">
        <div class="iframe-header">
            <div>Offer Wall</div>
            <button class="btn btn-secondary" id="closeIframe">Close</button>
        </div>
        <div class="iframe-content">
            <iframe id="dashboardIframe" src=""></iframe>
        </div>
    </div>
    
    <!-- MyChips SDK -->
    <script src="https://v1.mychips.io/SDK/latest/my-chips-sdk.bundle.js"></script>
    
    <script>
        // Global variables
        let captchaCode = '';
        let currentUser = null;
        const adUnit = 'default_ad_unit';

        // Google Apps Script URL for posting data to Google Sheets
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxLwW7NEXLMSDPh1A_PJbTjAucIuji6JtsgVu2xAdaMzXthTKsgk2xyWy83Dx8dO53Rrg/exec';

        // Object with offerwall URLs and open functions
        const offerwallButtons = {
            'openOfferWallCPX': (accountNumber) => `https://offers.cpx-research.com/index.php?app_id=26219&ext_user_id=${accountNumber}&username=${accountNumber}&subid_1=&subid_2`,
            'openOfferWallexcentiv': (accountNumber) => `https://excentiv.com/offerwall/?userid=${accountNumber}&key=q1v8KGQfCjmNeXnhsHyo`,
            'openOfferWallwannads': (accountNumber) => `https://earn.wannads.com/surveywall?apiKey=67d3d43d63631681386947&userId=${accountNumber}`,
            'openOfferWallmc': (accountNumber) => `https://sdk.mychips.io/content?content_id=16cbcd08-387a-498f-b4bd-9f4d2c6883a7&user_id=${accountNumber}&ad_unit_id=${adUnit}`,
            'openOfferWallSPARKWALL': (accountNumber) => `https://spark-wall.com/offerwall/G2kA8XaPF2jjstApSCZsK6aE6qudMN/${accountNumber}&username=${accountNumber}&subid_1=&subid_2`,
            'openOfferWallowm': (accountNumber) => `https://offerwallmedia.com/offerwall/vfox4w1tpz3gflta3gblkkqp8b2aoj/${accountNumber}`,
            'openOfferWalltw': (accountNumber) => `https://timewall.io/users/login?oid=0d54afcf2e6ff561&uid=${accountNumber}`,
            'openOfferWallprimewall': (accountNumber) => `https://primewall.io/offer/Yz3Uj8/${accountNumber}`,
            'openOfferWallrevtoo': (accountNumber) => `https://revtoo.com/offerwall/pmfo7u4ued9x4w5i0tvkrey32rcnwy/${accountNumber}`,
            'openOfferWallbuxiq': (accountNumber) => `https://bux-iq.netlify.app/cashout.html`,
            'openOfferWallnotik': (accountNumber) => `https://notik.me/coins?api_key=eQpYGMydTs5GP0DfFPQrJotOwKo6V0Hy&pub_id=LJ2g&app_id=GxEBh1Hn3m&user_id=${accountNumber}`
        };

        // DOM Content Loaded - Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            // Generate initial CAPTCHA
            generateCaptcha();

            // Check for existing session
            checkExistingSession();

            // Initialize all event listeners
            initializeEventListeners();

            // Start server time updates
            updateServerTime();
            setInterval(updateServerTime, 1000);
            
            // Update header time
            updateHeaderTime();
            setInterval(updateHeaderTime, 60000);
            
            // Load activity logs
            fetchCSV();
            
            // Load leaderboard
            loadLeaderboard();
        });

        // Initialize all event listeners
        function initializeEventListeners() {
            // Tab click handlers
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', e => {
                    e.preventDefault();
                    showSection(tab.dataset.section);
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                });
            });

            // Login button
            document.getElementById('loginButton')?.addEventListener('click', () => {
                showSection('earn');
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector('.tab[data-section="earn"]').classList.add('active');
            });

            // Login form handler
            document.getElementById('loginFormButton')?.addEventListener('click', handleLogin);

            // Iframe close button
            document.getElementById('closeIframe')?.addEventListener('click', closeIframe);

            // Logout button
            document.getElementById('logoutBtn')?.addEventListener('click', logout);

            // Contact support button
            document.getElementById('contact-support-btn')?.addEventListener('click', () => {
                alert('Please email support@buxiq.com for assistance.');
            });

            // Bonus redeem button
            document.getElementById('redeemBonusButton')?.addEventListener('click', redeemBonusCode);

            // Refresh logs button
            document.getElementById('refreshLogs')?.addEventListener('click', fetchCSV);

            // Initialize offerwall buttons
            initializeOfferwallButtons();
        }

        // Initialize offerwall buttons with user validation
        function initializeOfferwallButtons() {
            Object.keys(offerwallButtons).forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    // Remove any existing listeners to prevent duplicates
                    button.removeEventListener('click', offerwallClickHandler);
                    // Add new listener
                    button.addEventListener('click', offerwallClickHandler);
                }
            });
        }

        // Handler for offerwall button clicks
        function offerwallClickHandler(e) {
            e.preventDefault();

            if (!currentUser) {
                alert('Please login first to access offerwalls');
                showSection('earn');
                return;
            }

            const buttonId = this.id;
            const urlGenerator = offerwallButtons[buttonId];

            if (!urlGenerator) {
                console.error('No URL generator found for button:', buttonId);
                return;
            }

            // Use user[0] (account number) instead of user[4] (username)
            const accountNumber = currentUser[0] || 'user';
            const url = typeof urlGenerator === 'function' ? urlGenerator(accountNumber) : urlGenerator;

            console.log(`Opening offerwall ${buttonId} for account ${accountNumber}`);
            openIframe(url);
        }

        // Enhanced iframe functions
        function openIframe(url) {
            const iframeContainer = document.getElementById('iframeContainer');
            const dashboardIframe = document.getElementById('dashboardIframe');

            if (!iframeContainer || !dashboardIframe) {
                console.error('Iframe elements not found');
                return;
            }

            dashboardIframe.src = url;
            iframeContainer.style.display = 'block';
        }

        function closeIframe() {
            const iframeContainer = document.getElementById('iframeContainer');
            const dashboardIframe = document.getElementById('dashboardIframe');

            if (iframeContainer && dashboardIframe) {
                iframeContainer.style.display = 'none';
                dashboardIframe.src = '';
            }
        }

        // Update server time display
        function updateServerTime() {
            const now = new Date();

            // Convert to PST (UTC-8) or PDT (UTC-7) depending on daylight saving
            const pstOffset = now.getTimezoneOffset() >= 480 ? -8 * 60 : -7 * 60; // PST is UTC-8, PDT is UTC-7
            const pstTime = new Date(now.getTime() + (now.getTimezoneOffset() - pstOffset) * 60000);

            // Format as HH:MM:SS
            const hours = String(pstTime.getHours()).padStart(2, '0');
            const minutes = String(pstTime.getMinutes()).padStart(2, '0');
            const seconds = String(pstTime.getSeconds()).padStart(2, '0');

            document.getElementById('serverTime').textContent = `Server Time: ${hours}:${minutes}:${seconds} PST`;
        }

        // Update header time
        function updateHeaderTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            
            document.getElementById('headerTime').textContent = `${displayHours}:${minutes} ${ampm}`;
        }

        // Check for existing user session
        function checkExistingSession() {
            const savedAccount = localStorage.getItem('buxiq_account');
            const savedGoogleUser = localStorage.getItem('buxiq_google_user');
            
            if (savedGoogleUser) {
                // Handle Google user session restoration with blocked check
                checkAndRestoreGoogleSession(savedGoogleUser);
            } else if (savedAccount) {
                // Handle manual login session restoration
                restoreManualSession(savedAccount);
            } else {
                // Show default section if no session
                showSection('dashboard');
            }
        }

        // Check and restore Google session with blocked validation
        async function checkAndRestoreGoogleSession(savedGoogleUser) {
            try {
                const googleUser = JSON.parse(savedGoogleUser);
                
                // Check if user still exists and is not blocked
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.text();
                const rows = data.trim().split('\n').map(row => row.split(','));

                // Find user by Google ID or email
                const user = rows.find(r => r[7] === googleUser.id || r[8] === googleUser.email);

                if (user) {
                    // Check if user is blocked
                    const status = (user[2] || '').toLowerCase();
                    if (status === 'blocked') {
                        // Clear blocked user session
                        localStorage.removeItem('buxiq_google_user');
                        showSection('dashboard');
                        return;
                    }
                    
                    // Update stored Google user data with account number
                    googleUser.account = user[0];
                    googleUser.clientId = user[1];
                    localStorage.setItem('buxiq_google_user', JSON.stringify(googleUser));
                    
                    // User is valid, restore session
                    simulateGoogleLoginRestore(googleUser);
                } else {
                    // User not found in database, clear session
                    localStorage.removeItem('buxiq_google_user');
                }
            } catch (err) {
                console.error('Error checking Google session:', err);
                // On error, clear session to be safe
                localStorage.removeItem('buxiq_google_user');
            }
        }

        // Restore manual session
        async function restoreManualSession(account) {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.text();
                const rows = data.trim().split('\n').map(row => row.split(','));

                // Find user by account number
                const user = rows.find(r => r[0] === account);

                if (user) {
                    // Check if user is blocked
                    const status = (user[2] || '').toLowerCase();
                    if (status === 'blocked') {
                        // Clear blocked user session
                        localStorage.removeItem('buxiq_account');
                        return;
                    }
                    
                    currentUser = user;
                    updateUserUI(user);
                    
                    // Show dashboard
                    document.getElementById('login-container').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    
                    // Update balance
                    await updateBalance();
                    
                    addToLogs(`Session restored for ${user[4] || 'User'}`);
                } else {
                    // Clear invalid session
                    localStorage.removeItem('buxiq_account');
                }
            } catch (err) {
                console.error('Error restoring session:', err);
            }
        }

        // Simulate Google login restore
        function simulateGoogleLoginRestore(googleUser) {
            const simulatedUser = {
                email: googleUser.email,
                name: googleUser.name,
                id: googleUser.id,
                picture: googleUser.picture,
                account: googleUser.account, // Include account number
                clientId: googleUser.clientId // Include client ID
            };
            processGoogleLogin(simulatedUser);
        }

        // Handle Google Sign-In response
        function handleGoogleCredentialResponse(response) {
            console.log("Google Sign-In response:", response);
            
            // Decode the JWT token to get user info
            const responsePayload = parseJwt(response.credential);
            
            console.log("Google user info:", responsePayload);
            
            // Process Google login with the user info
            processGoogleLogin({
                id: responsePayload.sub,
                email: responsePayload.email,
                name: responsePayload.name,
                picture: responsePayload.picture
            });
        }

        // Parse JWT token
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                
                return JSON.parse(jsonPayload);
            } catch (e) {
                console.error("Error parsing JWT:", e);
                return null;
            }
        }

        // Process Google Login
        async function processGoogleLogin(googleUser) {
            const errorMsg = document.getElementById('error-msg');
            
            try {
                // Check if user exists in Google Sheets
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.text();
                const rows = data.trim().split('\n').map(row => row.split(','));

                // Look for user by Google ID or email
                const user = rows.find(r => r[7] === googleUser.id || r[8] === googleUser.email);

                if (user) {
                    // Check if user is blocked
                    const status = (user[2] || '').toLowerCase();
                    if (status === 'blocked') {
                        showError(errorMsg, 'Your account is blocked.');
                        // Clear any stored Google session data
                        localStorage.removeItem('buxiq_google_user');
                        return;
                    }

                    // Existing user - login
                    currentUser = user;
                    await completeLogin(user);
                    
                    // Store session for Google user
                    localStorage.setItem('buxiq_google_user', JSON.stringify({
                        id: googleUser.id,
                        email: googleUser.email,
                        name: googleUser.name,
                        picture: googleUser.picture,
                        account: user[0], // Store the generated account number
                        clientId: user[1] // Store the generated client ID
                    }));
                    
                    // Initialize MyChips SDK for this user
                    if (typeof myChipsSDK !== 'undefined') {
                        myChipsSDK('init', {userId: user[0]});
                    }
                } else {
                    // New user - auto-register
                    await registerGoogleUser(googleUser);
                }
            } catch (err) {
                console.error('Google login processing error:', err);
                showError(errorMsg, 'Error during Google login. Please try again.');
            }
        }

        // Register new Google user
        async function registerGoogleUser(googleUser) {
            // Generate unique account number and client ID
            const accountNumber = 'G' + Math.random().toString(36).substr(2, 8).toUpperCase();
            const clientId = 'GC' + Math.random().toString(36).substr(2, 6).toUpperCase();
            
            // Create new user data
            const newUser = [
                accountNumber,      // 0: Account #
                clientId,          // 1: Client ID
                'active',          // 2: Status
                '0.00',           // 3: Balance
                googleUser.name,   // 4: Username
                googleUser.picture, // 5: Avatar URL (Google profile picture)
                '1',              // 6: Level
                googleUser.id,    // 7: Google ID
                googleUser.email  // 8: Google Email
            ];
            
            // Post new user to Google Sheets
            await postUserToSheets(newUser);
            
            // In a real implementation, you would send this to your backend/Google Apps Script
            // For now, we'll use the new user data directly
            currentUser = newUser;
            
            // Store in localStorage
            localStorage.setItem('buxiq_google_user', JSON.stringify({
                id: googleUser.id,
                email: googleUser.email,
                name: googleUser.name,
                picture: googleUser.picture,
                account: accountNumber,
                clientId: clientId
            }));
            
            await completeLogin(newUser);
            
            // Initialize MyChips SDK for this user
            if (typeof myChipsSDK !== 'undefined') {
                myChipsSDK('init', {userId: accountNumber});
            }
            
            // Show welcome message for new users
            addToLogs(`Welcome ${googleUser.name}! Your account has been created.`);
        }

        // Post user data to Google Sheets
        async function postUserToSheets(userData) {
            try {
                // Prepare data for Google Sheets
                const formData = new FormData();
                formData.append('action', 'addUser');
                formData.append('account', userData[0]);
                formData.append('clientId', userData[1]);
                formData.append('status', userData[2]);
                formData.append('balance', userData[3]);
                formData.append('username', userData[4]);
                formData.append('avatar', userData[5]);
                formData.append('level', userData[6]);
                formData.append('googleId', userData[7]);
                formData.append('googleEmail', userData[8]);
                
                // Send POST request to Google Apps Script
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    console.log('User data successfully posted to Google Sheets');
                    return true;
                } else {
                    console.error('Failed to post user data to Google Sheets');
                    return false;
                }
            } catch (error) {
                console.error('Error posting user data to Google Sheets:', error);
                return false;
            }
        }

        // Login handler
        async function handleLogin(e) {
            e.preventDefault();

            const account = document.getElementById('login-account')?.value?.trim() || '';
            const clientid = document.getElementById('login-clientid')?.value?.trim() || '';
            const captchaInput = document.getElementById('captchaInput')?.value?.trim() || '';
            const errorMsg = document.getElementById('error-msg');

            if (captchaInput !== captchaCode) {
                showError(errorMsg, 'Invalid CAPTCHA');
                generateCaptcha();
                document.getElementById('captchaInput').value = '';
                return;
            }

            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.text();
                const rows = data.trim().split('\n').map(row => row.split(','));

                // Find user in spreadsheet data based on account and clientid
                const user = rows.find(r => r[0] === account && r[1] === clientid);

                if (user) {
                    const status = (user[2] || '').toLowerCase();
                    if (status === 'blocked') {
                        showError(errorMsg, 'Your account is blocked.');
                        // Clear login fields and generate new CAPTCHA on blocked account
                        document.getElementById('login-account').value = '';
                        document.getElementById('login-clientid').value = '';
                        document.getElementById('captchaInput').value = '';
                        generateCaptcha();
                        return;
                    }

                    // Store current user globally
                    currentUser = user;

                    // Store in local storage
                    localStorage.setItem('buxiq_account', account);

                    // Update UI with user data
                    updateUserUI(user);

                    // Show dashboard
                    document.getElementById('login-container')?.classList.add('hidden');
                    document.getElementById('dashboard')?.classList.remove('hidden');
                    if (errorMsg) errorMsg.classList.add('hidden');

                    // Initialize offerwalls for this user
                    initializeOfferwallButtons();
                    
                    // Initialize MyChips SDK for this user
                    if (typeof myChipsSDK !== 'undefined') {
                        myChipsSDK('init', {userId: account});
                    }

                    // Load additional data
                    fetchCSV(); // For activity logs
                    updateBalance(); // Update balance immediately after login
                    
                    addToLogs(`Login successful for ${user[4] || 'User'}`);
                } else {
                    showError(errorMsg, 'Invalid credentials');
                    // Clear CAPTCHA input and generate new CAPTCHA on invalid credentials
                    document.getElementById('captchaInput').value = '';
                    generateCaptcha();
                }
            } catch (err) {
                console.error('Login error:', err);
                showError(errorMsg, 'Error loading data. Please try again.');
                // Clear CAPTCHA input and generate new CAPTCHA on error
                document.getElementById('captchaInput').value = '';
                generateCaptcha();
            }
        }

        // Complete login process for both manual and Google login
        async function completeLogin(user) {
            // Update user data
            const avatarUrl = user[5] || `https://ui-avatars.com/api/?name=${encodeURIComponent(user[4] || 'User')}&background=3a86ff&color=fff`;
            
            // Update UI
            document.getElementById('userAvatar').src = avatarUrl;
            document.getElementById('userName').textContent = user[4] || 'User';
            
            // Show dashboard
            document.getElementById('login-container').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('error-msg').classList.add('hidden');
            
            // Update balance and level
            await updateBalance();
            
            // Add login success message
            addToLogs(`Login successful for ${user[4] || 'User'}`);
        }

        // Helper function to show errors
        function showError(element, message) {
            if (element) {
                element.textContent = message;
                element.classList.remove('hidden');
            } else {
                alert(message);
            }
        }

        // Update user UI after login
        function updateUserUI(user) {
            try {
                const avatarUrl = user[5] || `https://ui-avatars.com/api/?name=${encodeURIComponent(user[4] || 'User')}&background=3a86ff&color=fff`;

                // Update avatar
                const userAvatar = document.getElementById('userAvatar');
                if (userAvatar) userAvatar.src = avatarUrl;

                // Update username
                const usernameEl = document.getElementById('userName');
                if (usernameEl) usernameEl.textContent = user[4] || 'User';

                // Update level
                const levelEl = document.getElementById('userLevel');
                if (levelEl) levelEl.textContent = user[6] || '1';

                // Update balance
                updateBalance();
            } catch (error) {
                console.error('Error updating user UI:', error);
            }
        }

        // Logout function
        function logout() {
            try {
                if (currentUser) {
                    // If it's a Google user, remove Google data too
                    if (currentUser[7]) { // Google ID exists
                        localStorage.removeItem('buxiq_google_user');
                    }
                }

                currentUser = null;
                localStorage.removeItem('buxiq_account');

                document.getElementById('dashboard')?.classList.add('hidden');
                document.getElementById('login-container')?.classList.remove('hidden');
                document.getElementById('login-account').value = '';
                document.getElementById('login-clientid').value = '';
                document.getElementById('captchaInput').value = '';

                const errorMsg = document.getElementById('error-msg');
                if (errorMsg) errorMsg.classList.add('hidden');

                generateCaptcha();
                showSection('dashboard'); // Return to default 'dashboard' section on logout

                // Reset user info display
                const userAvatar = document.getElementById('userAvatar');
                const usernameEl = document.getElementById('userName');
                const levelEl = document.getElementById('userLevel');
                const balanceEl = document.getElementById('userBalance');
                
                if (userAvatar) userAvatar.src = 'https://ui-avatars.com/api/?background=3a86ff&color=fff&name=Guest&bold=true';
                if (usernameEl) usernameEl.textContent = 'Guest User';
                if (levelEl) levelEl.textContent = '0';
                if (balanceEl) balanceEl.textContent = '$0.00';
                
                addToLogs('You have been logged out.');
            } catch (error) {
                console.error('Error during logout:', error);
            }
        }

        // Generate CAPTCHA
        function generateCaptcha() {
            try {
                captchaCode = Math.floor(10000 + Math.random() * 90000).toString();
                const captchaEl = document.getElementById('captcha');
                if (captchaEl) {
                    captchaEl.textContent = captchaCode;
                }
                return captchaCode;
            } catch (error) {
                console.error('Error generating CAPTCHA:', error);
                return '12345'; // Fallback CAPTCHA
            }
        }

        // Navigation handler
        function showSection(section) {
            try {
                const sections = ['dashboard', 'earn', 'shop', 'leaders', 'bonus', 'help', 'tos'];
                sections.forEach(sec => {
                    const sectionEl = document.getElementById('section-' + sec);
                    if (sectionEl) {
                        sectionEl.classList.toggle('hidden', sec !== section);
                    }
                });
            } catch (error) {
                console.error('Error showing section:', error);
            }
        }

        // Update balance function (can be called separately to refresh)
        async function updateBalance() {
            try {
                if (!currentUser) {
                    console.warn('Cannot update balance: no current user.');
                    return;
                }

                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
                if (!response.ok) throw new Error('Network error');

                const data = await response.text();
                const rows = data.trim().split('\n').map(r => r.split(','));
                // Find user by account and clientid for accuracy
                const user = rows.find(r => r[0] === currentUser[0] && r[1] === currentUser[1]);

                const balanceEl = document.getElementById('userBalance');
                const levelEl = document.getElementById('userLevel');

                if (user) {
                    // Fix NaN issue by ensuring we have a valid number
                    const balance = parseFloat(user[3] || '0');
                    if (!isNaN(balance)) {
                        if (balanceEl) balanceEl.textContent = `$${balance.toFixed(2)}`;
                    } else {
                        if (balanceEl) balanceEl.textContent = '$0.00';
                    }
                    
                    // Update level
                    if (levelEl) levelEl.textContent = user[6] || '1';
                    
                    // Update currentUser with latest data
                    currentUser = user;
                } else {
                    // If user not found (e.g., after logout), reset balance display to 0
                    if (balanceEl) balanceEl.textContent = '$0.00';
                    if (levelEl) levelEl.textContent = '0';
                }
            } catch (err) {
                console.error('Error updating balance:', err);
            }
        }

        // Fetch CSV for activity logs
        async function fetchCSV() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3p3daAnCETfJtrUUvaiNqoUreYkn9FIHus6rEyq-e8E8oLaV51L_NrVWjHp1CyTv3UqBqryq3aH-0/pub?gid=0&single=true&output=csv');
                if (!response.ok) throw new Error('Network error');

                const data = await response.text();
                const rows = data.trim().split('\n').slice(1); // skip header
                const logsContainer = document.getElementById('logs');

                if (!logsContainer) return;
                
                // Clear existing logs except the initial message
                const initialMessage = logsContainer.querySelector('.activity-item');
                logsContainer.innerHTML = '';
                if (initialMessage && rows.length === 0) {
                    logsContainer.appendChild(initialMessage);
                }

                let hasLogs = false;
                rows.forEach((row, index) => {
                    const cols = row.split(',').map(c => c.trim());
                    // Ensure necessary columns exist and are not empty
                    if (cols.length >= 7 && cols[2] && cols[6]) {
                        hasLogs = true;
                        const username = cols[2];
                        const amount = parseFloat(cols[6]).toFixed(2); // Format amount to 2 decimal places
                        const logDiv = document.createElement('div');
                        logDiv.className = 'activity-item';
                        logDiv.innerHTML = `
                            <div class="activity-icon"><i class="fas fa-user"></i></div>
                            <div>${username} earned $${amount}</div>
                        `;
                        logsContainer.appendChild(logDiv);
                    }
                });

                if (!hasLogs && initialMessage) {
                    // Keep the initial message if no logs
                }
            } catch (err) {
                console.error('Error fetching activity logs:', err);
                const logsContainer = document.getElementById('logs');
                if (logsContainer) {
                    logsContainer.innerHTML = '<div class="activity-item"><div class="activity-icon"><i class="fas fa-exclamation-triangle"></i></div><div>Error loading activity logs.</div></div>';
                }
            }
        }

        // Load leaderboard from CSV
        async function loadLeaderboard() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQHuo-I6k4RbAnXvz_FvCzshqg7Cm5dqAXwNkvDLpgpZH84OGUSbX6TiOUfMrCHv3CiNnLnx0IhzNZC/pub?gid=0&single=true&output=csv');
                if (!response.ok) throw new Error('Network error');

                const data = await response.text();
                const rows = data.trim().split('\n').slice(1); // skip header
                
                // Sort users by balance (descending)
                const users = rows.map(row => {
                    const cols = row.split(',');
                    return {
                        username: cols[4] || 'Unknown',
                        balance: parseFloat(cols[3] || 0),
                        level: cols[6] || '1'
                    };
                }).sort((a, b) => b.balance - a.balance).slice(0, 10); // Top 10 users
                
                const leaderboardBody = document.getElementById('leaderboardBody');
                if (!leaderboardBody) return;
                
                leaderboardBody.innerHTML = '';
                
                users.forEach((user, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${user.username}</td>
                        <td>$${user.balance.toFixed(2)}</td>
                        <td>${user.level}</td>
                    `;
                    leaderboardBody.appendChild(row);
                });
            } catch (err) {
                console.error('Error loading leaderboard:', err);
            }
        }

        // Helper function to add messages to logs
        function addToLogs(message) {
            const logsContainer = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = 'activity-item';
            logEntry.innerHTML = `
                <div class="activity-icon"><i class="fas fa-info-circle"></i></div>
                <div>${new Date().toLocaleTimeString()} - ${message}</div>
            `;
            
            // Remove initial placeholder if it exists
            const initialMessage = logsContainer.querySelector('.activity-item:first-child');
            if (initialMessage && initialMessage.textContent.includes('activity log will appear here')) {
                logsContainer.removeChild(initialMessage);
            }
            
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // Bonus Code Redemption
        async function redeemBonusCode() {
            const username = document.getElementById('username')?.value?.trim();
            const bonusCode = document.getElementById('bonusCode')?.value?.trim();
            
            if (!username || !bonusCode) {
                alert('Please fill in all fields');
                return;
            }
            
            try {
                // Send a request to the Google Apps Script web app to fetch data from the Google Sheets
                const response = await fetch(`https://script.google.com/macros/s/AKfycbxmqOnPJLPuHD6u_DD66bwY0R4MYQ8v9uF1Mv0pm8Sg9APSS4R4oXzbs3zin2FoTMK5/exec?username=${username}&bonusCode=${bonusCode}`);
                const result = await response.text();

                console.log('Bonus redemption result:', result); // For debugging

                if (result.includes("Error")) {
                    alert(result);
                } else {
                    const [amountLocal, amountUsd] = result.split(','); // Expecting data in format "amountLocal,amountUsd"
                    document.getElementById('amountLocal').value = amountLocal;
                    document.getElementById('amountUsd').value = amountUsd;
                    sendPostback(amountLocal, amountUsd, username, bonusCode); // Call the postback function
                    alert('Bonus code redeemed successfully!');
                }
            } catch (error) {
                console.error('Error redeeming bonus code:', error);
                alert('Error redeeming bonus code. Please try again.');
            }
        }

        // Postback Function
        function sendPostback(amountLocal, amountUsd, username, bonusCode) {
            const timestamp = new Date().getTime();
            const postbackUrl = `https://script.google.com/macros/s/AKfycbyvw4LiShTvgnTTLRLISnTYJRhqeStmZgL9YD_ZuQEJubcDPH8bSbGpHPCVHDfx0dbW/exec?status=success&trans_id=${timestamp}&user_id=${username}&bonusCode=${bonusCode}&sub_id=&sub_id_2=&amount_local=${amountLocal}&amount_usd=${amountUsd}&offer_id=offer001&hash=secure_hash_value&ip_click=192.168.1.1`;

            fetch(postbackUrl)
                .then(response => response.json())
                .then(data => console.log('Postback Success:', data))
                .catch(error => console.error('Postback Error:', error));
        }
    </script>
</body>
</html>
